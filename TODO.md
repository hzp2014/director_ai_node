# TODO - å¾…åŠäº‹é¡¹

## ğŸ‰ æ–°å¢åŠŸèƒ½ï¼ˆä»å®‰å“é¡¹ç›®è¿ç§»ï¼‰

### âœ… å·²å®Œæˆ - P0 æ ¸å¿ƒåŠŸèƒ½

- [x] æ›´æ–°é…ç½®ç®¡ç† (`src/config.js`)
  - [x] æ·»åŠ æ™ºè°±GLM APIé…ç½®
  - [x] æ·»åŠ è±†åŒ…ARK APIé…ç½®
  - [x] æ·»åŠ è§†é¢‘ç”ŸæˆAPIé…ç½®
  - [x] æ·»åŠ å¹¶å‘é…ç½®
  - [x] æ·»åŠ Mockæ¨¡å¼é…ç½®
  - [x] æ·»åŠ FFmpegé…ç½®
  - [x] æ·»åŠ è§’è‰²ä¸€è‡´æ€§é…ç½®

- [x] å®ç°è§†é¢‘ç”ŸæˆAPIå®¢æˆ·ç«¯ (`src/videoGenerator.js`)
  - [x] VideoGenerationResponse æ•°æ®æ¨¡å‹
  - [x] VideoGenerator ç±»
  - [x] generateVideo() - è§†é¢‘ç”Ÿæˆ
  - [x] pollVideoStatus() - è§†é¢‘è½®è¯¢
  - [x] cancelVideoGeneration() - å–æ¶ˆç”Ÿæˆ
  - [x] _sanitizeVideoPrompt() - æç¤ºè¯å‡€åŒ–
  - [x] Mockæ¨¡å¼æ”¯æŒ

- [x] å®ç°AIå¯¹è¯å®¢æˆ·ç«¯ (`src/aiClient.js`)
  - [x] ChatMessage æ•°æ®æ¨¡å‹
  - [x] StreamChunk æ•°æ®æ¨¡å‹
  - [x] AIClient ç±»
  - [x] sendToGLMStream() - GLMæµå¼å¯¹è¯
  - [x] sendToGLM() - GLMéæµå¼å¯¹è¯
  - [x] analyzeImageForCharacter() - è±†åŒ…å›¾ç‰‡åˆ†æ
  - [x] rewriteVideoPromptForSafety() - æç¤ºè¯é‡å†™
  - [x] Mockæ¨¡å¼æ”¯æŒ

- [x] å®ç°å‰§æœ¬æ•°æ®æ¨¡å‹ (`src/screenplayModels.js`)
  - [x] SceneStatus æšä¸¾
  - [x] ScreenplayStatus æšä¸¾
  - [x] Scene ç±»
  - [x] Screenplay ç±»
  - [x] ScreenplayProgress ç±»

- [x] å®ç°å‰§æœ¬ç®¡ç†æœåŠ¡ (`src/screenplayService.js`)
  - [x] ScreenplayService ç±»
  - [x] generateScreenplay() - å®Œæ•´å‰§æœ¬ç”Ÿæˆæµç¨‹
  - [x] generateFromConfirmed() - ä»ç¡®è®¤å‰§æœ¬ç”Ÿæˆ
  - [x] retryScene() - é‡è¯•å•ä¸ªåœºæ™¯
  - [x] startSceneGeneration() - æ‰‹åŠ¨è§¦å‘åœºæ™¯ç”Ÿæˆ
  - [x] startAllPendingScenesGeneration() - æ‰‹åŠ¨è§¦å‘æ‰€æœ‰å¾…å¤„ç†åœºæ™¯
  - [x] updateSceneCustomPrompt() - æ›´æ–°åœºæ™¯è‡ªå®šä¹‰æç¤ºè¯
  - [x] cancel() - å–æ¶ˆæ“ä½œ
  - [x] _analyzeUserImage() - åˆ†æç”¨æˆ·å›¾ç‰‡
  - [x] _callGLMForScreenplay() - è°ƒç”¨GLMç”Ÿæˆå‰§æœ¬
  - [x] _parseScreenplay() - è§£æå‰§æœ¬JSON
  - [x] _generateAllImages() - æ‰¹é‡ç”Ÿæˆå›¾ç‰‡
  - [x] _generateAllVideos() - æ‰¹é‡ç”Ÿæˆè§†é¢‘
  - [x] è¿›åº¦å›è°ƒæ”¯æŒ
  - [x] å–æ¶ˆæœºåˆ¶æ”¯æŒ

- [x] æ›´æ–°ä¾èµ–é…ç½® (`package.json`)
  - [x] æ·»åŠ  fluent-ffmpeg ä¾èµ–

- [x] æ›´æ–°ç¯å¢ƒå˜é‡é…ç½® (`.env.example`)
  - [x] æ·»åŠ æ™ºè°±GLM APIé…ç½®
  - [x] æ·»åŠ è±†åŒ…ARK APIé…ç½®
  - [x] æ·»åŠ è§†é¢‘ç”ŸæˆAPIé…ç½®
  - [x] æ·»åŠ å¹¶å‘é…ç½®
  - [x] æ·»åŠ Mockæ¨¡å¼é…ç½®
  - [x] æ·»åŠ FFmpegé…ç½®
  - [x] æ·»åŠ è§’è‰²ä¸€è‡´æ€§é…ç½®

- [x] æ›´æ–°Web UIç•Œé¢ (`public/`)
  - [x] æ·»åŠ å‰§æœ¬ç®¡ç†æ ‡ç­¾é¡µ
  - [x] å®ç°AIå‰§æœ¬ç”Ÿæˆç•Œé¢
  - [x] æ·»åŠ ç”Ÿæˆè¿›åº¦æ˜¾ç¤º
  - [x] æ›´æ–°é•œå¤´æ¨¡æ€æ¡†ï¼ˆæ”¯æŒè§†é¢‘ï¼‰
  - [x] æ·»åŠ ç”Ÿæˆè¿›åº¦æ¨¡æ€æ¡†
  - [x] å®ç°åœºæ™¯å¡ç‰‡ç•Œé¢
  - [x] æ·»åŠ è§†é¢‘æ’­æ”¾åŠŸèƒ½
  - [x] å®ç°é‡è¯•åŠŸèƒ½
  - [x] æ·»åŠ è‡ªå®šä¹‰æç¤ºè¯ç¼–è¾‘

### ğŸ“‹ å¾…å®ç° - P1 é‡è¦åŠŸèƒ½

- [ ] æ‰©å±•APIè·¯ç”± (`src/app.js`)
  - [ ] è§†é¢‘ç”Ÿæˆç›¸å…³è·¯ç”±
    - [ ] POST /api/projects/:id/generate-video
    - [ ] POST /api/projects/:id/generate-all-videos
    - [ ] GET /api/video/status/:taskId
  - [ ] å‰§æœ¬ç®¡ç†ç›¸å…³è·¯ç”±
    - [ ] POST /api/screenplay
    - [ ] POST /api/screenplay/:id/confirm
    - [ ] POST /api/screenplay/:id/generate
    - [ ] POST /api/screenplay/:id/retry/:sceneId
    - [ ] POST /api/screenplay/:id/start/:sceneId
    - [ ] GET /api/screenplay/:id/progress
  - [ ] AIå¯¹è¯ç›¸å…³è·¯ç”±
    - [ ] POST /api/ai/chat
    - [ ] POST /api/ai/analyze-image
    - [ ] POST /api/ai/rewrite-prompt
  - [ ] è¿›åº¦å’Œå–æ¶ˆç›¸å…³è·¯ç”±
    - [ ] GET /api/tasks/:taskId/progress
    - [ ] POST /api/tasks/:taskId/cancel

- [ ] å®ç°è§†é¢‘åˆå¹¶æœåŠ¡ (`src/videoMerger.js`)
  - [ ] VideoMerger ç±»
  - [ ] mergeVideos() - åˆå¹¶è§†é¢‘
  - [ ] mergeVideosLossless() - æ— æŸåˆå¹¶
  - [ ] getMergedVideos() - è·å–åˆå¹¶è§†é¢‘åˆ—è¡¨
  - [ ] clearMergedVideos() - æ¸…ç†åˆå¹¶è§†é¢‘
  - [ ] getMergedVideosSize() - è·å–åˆå¹¶è§†é¢‘å¤§å°
  - [ ] getMergedVideosCount() - è·å–åˆå¹¶è§†é¢‘æ•°é‡

- [ ] è§†é¢‘åˆå¹¶ç›¸å…³è·¯ç”± (`src/app.js`)
  - [ ] POST /api/videos/merge
  - [ ] GET /api/videos/merged
  - [ ] DELETE /api/videos/merged

- [ ] å•å…ƒæµ‹è¯•
  - [ ] videoGenerator.js æµ‹è¯•
  - [ ] aiClient.js æµ‹è¯•
  - [ ] screenplayService.js æµ‹è¯•
  - [ ] screenplayModels.js æµ‹è¯•

### ğŸ“‹ å¾…å®ç° - P2 å¢å¼ºåŠŸèƒ½

- [ ] è§’è‰²ä¸‰è§†å›¾ç”ŸæˆåŠŸèƒ½
  - [ ] ç”Ÿæˆåˆ†é•œå¤´è§’è‰²ä¸‰è§†å›¾
  - [ ] ä¸‰è§†å›¾URLç®¡ç†
  - [ ] è·¨åœºæ™¯äººç‰©ä¸€è‡´æ€§ä¼˜åŒ–

- [ ] ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
  - [ ] TaskQueue ç±»
  - [ ] ä¼˜å…ˆçº§è°ƒåº¦
  - [ ] ä»»åŠ¡æŒä¹…åŒ–
  - [ ] ä»»åŠ¡é‡è¯•ç­–ç•¥

- [ ] é›†æˆæµ‹è¯•
  - [ ] ç«¯åˆ°ç«¯æµ‹è¯•
  - [ ] APIæµ‹è¯•
  - [ ] æ€§èƒ½æµ‹è¯•

- [ ] æ–‡æ¡£æ›´æ–°
  - [ ] APIæ–‡æ¡£
  - [ ] ä½¿ç”¨æ•™ç¨‹
  - [ ] æ¶æ„æ–‡æ¡£

## åŸæœ‰å¾…åŠäº‹é¡¹ï¼ˆä»éœ€å®Œæˆï¼‰

### ä¸­ä¼˜å…ˆçº§

- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
  - [ ] promptGenerator.js æµ‹è¯•
  - [ ] services.js æµ‹è¯•
  - [ ] API è·¯ç”±æµ‹è¯•

### ä½ä¼˜å…ˆçº§

- [ ] æ·»åŠ éªŒè¯å·¥å…·
  - [ ] è¯·æ±‚å‚æ•°éªŒè¯ä¸­é—´ä»¶
  - [ ] æ–‡ä»¶ç±»å‹éªŒè¯
  - [ ] æ–‡ä»¶å¤§å°éªŒè¯

- [ ] æ·»åŠ ç¼“å­˜æœºåˆ¶
  - [ ] å†…å­˜ç¼“å­˜
  - [ ] ç£ç›˜ç¼“å­˜
  - [ ] ç¼“å­˜è¿‡æœŸç­–ç•¥

### å¯é€‰åŠŸèƒ½

- [ ] æ·»åŠ æ›´å¤šæµ‹è¯•
  - [ ] é›†æˆæµ‹è¯•
  - [ ] API è·¯ç”±æµ‹è¯•

- [ ] æ€§èƒ½ä¼˜åŒ–
  - [ ] å›¾ç‰‡å¤„ç†ä¼˜åŒ–
  - [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–

- [ ] å®Œå–„æ–‡æ¡£
  - [ ] API æ–‡æ¡£
    - [ ] OpenAPI/Swagger è§„èŒƒ
    - [ ] è¯·æ±‚/å“åº”ç¤ºä¾‹
    - [ ] é”™è¯¯ç è¯´æ˜
  - [ ] å¼€å‘æ–‡æ¡£
    - [ ] æ¶æ„è®¾è®¡æ–‡æ¡£
    - [ ] ä»£ç è§„èŒƒ
    - [ ] è´¡çŒ®æŒ‡å—
  - [ ] ç”¨æˆ·æ–‡æ¡£
    - [ ] å®‰è£…æŒ‡å—
    - [ ] ä½¿ç”¨æ•™ç¨‹
    - [ ] å¸¸è§é—®é¢˜è§£ç­”

- [ ] æ‰©å±•åŠŸèƒ½
  - [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼å¯¼å…¥ï¼ˆPDFã€DOCXï¼‰
  - [ ] æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

## æŠ€æœ¯å€ºåŠ¡

- [ ] ä»£ç å®¡æŸ¥å’Œé‡æ„
  - [ ] æ£€æŸ¥ä»£ç é£æ ¼ä¸€è‡´æ€§
  - [ ] é‡æ„é‡å¤ä»£ç 
  - [ ] ä¼˜åŒ–å¤æ‚é€»è¾‘

- [ ] ä¾èµ–æ›´æ–°
  - [ ] å®šæœŸæ›´æ–°ä¾èµ–åŒ…
  - [ ] æ£€æŸ¥å®‰å…¨æ¼æ´
  - [ ] æ›´æ–°æ–‡æ¡£ä¸­çš„ç‰ˆæœ¬å·

- [ ] é…ç½®ç®¡ç†
  - [ ] æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆdev, staging, prodï¼‰
  - [ ] é…ç½®éªŒè¯å¢å¼º
  - [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†

## å¤‡æ³¨

1. **æ–‡ä»¶æ‰©å±•å**: Node.js æ–‡ä»¶ä½¿ç”¨ `.js` è€Œé `.mjs`ï¼Œå› ä¸º package.json ä¸­è®¾ç½®äº† `"type": "module"`

2. **ä¾èµ–ç®¡ç†**:
   - è§†é¢‘åˆå¹¶éœ€è¦ `fluent-ffmpeg` åŒ…
   - å›¾ç‰‡ç”Ÿæˆéœ€è¦å·²æœ‰çš„ API å®¢æˆ·ç«¯

3. **é”™è¯¯å¤„ç†**:
   - æ‰€æœ‰å¼‚æ­¥å‡½æ•°éƒ½åº”è¯¥æœ‰ try-catch
   - ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
   - è®°å½•é”™è¯¯æ—¥å¿—

4. **æ–‡ä»¶è·¯å¾„**:
   - ä½¿ç”¨ `path.join()` æˆ– `path.resolve()` å¤„ç†è·¯å¾„
   - é¿å…ä½¿ç”¨ `./` æˆ– `../` ç›¸å¯¹è·¯å¾„

5. **å¹¶å‘æ§åˆ¶**:
   - å·²æ·»åŠ å¹¶å‘é…ç½® `CONCURRENT_SCENES`
   - éœ€è¦å®ç°ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

## æœ€åæ›´æ–°

- **æ—¥æœŸ**: 2026-02-01
- **æ€»ä»»åŠ¡æ•°**: çº¦ 100+
- **å·²å®Œæˆ**: çº¦ 65/100+ (65%)
- **è¿›è¡Œä¸­**: çº¦ 0/100+ (0%)
- **å¾…å¼€å§‹**: çº¦ 35/100+ (35%)
- **æ ¸å¿ƒåŠŸèƒ½**: P0 æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼ŒP1 é‡è¦åŠŸèƒ½å¾…å®ç°
