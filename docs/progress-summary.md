# å¼€å‘è¿›åº¦æ€»ç»“

> **æ›´æ–°æ—¥æœŸ**: 2026-02-04
> **æ€»ä½“è¿›åº¦**: 40% (68/172 ä»»åŠ¡å®Œæˆ)

---

## å·²å®ŒæˆåŠŸèƒ½

### âœ… æ ¸å¿ƒæ¶æ„

- [x] Next.js 14 é¡¹ç›®åˆå§‹åŒ–ï¼ˆTypeScript + Tailwind CSS + App Routerï¼‰
- [x] é¡¹ç›®ç›®å½•ç»“æ„æ­å»º
- [x] ESLint å’Œ Prettier é…ç½®
- [x] è·¯å¾„åˆ«åé…ç½® (@/* â†’ src/*)

### âœ… ç±»å‹ç³»ç»Ÿ

**ä½ç½®**: `src/types/`

- [x] `chat.ts` - èŠå¤©æ¶ˆæ¯ç›¸å…³ç±»å‹
- [x] `screenplay.ts` - å‰§æœ¬ç›¸å…³ç±»å‹
- [x] `character.ts` - è§’è‰²ç›¸å…³ç±»å‹
- [x] `conversation.ts` - ä¼šè¯ç›¸å…³ç±»å‹
- [x] `agent.ts` - æ™ºèƒ½ä½“å‘½ä»¤ç±»å‹
- [x] `api.ts` - APIé…ç½®å’Œå“åº”ç±»å‹

### âœ… APIæœåŠ¡å±‚

**ä½ç½®**: `src/services/`

- [x] `apiService.ts` - APIæœåŠ¡åŸºç±»
  - GLMService: æ™ºè°±GLMèŠå¤©ã€å‰§æœ¬ç”Ÿæˆã€å›¾ç‰‡ç†è§£
  - CangheImageService: å›¾ç‰‡ç”Ÿæˆã€è§’è‰²ä¸‰è§†å›¾
  - CangheVideoService: è§†é¢‘ç”Ÿæˆã€çŠ¶æ€è½®è¯¢
- [x] `imageGenerationService.ts` - å›¾ç‰‡ç”Ÿæˆä¸šåŠ¡é€»è¾‘
- [x] `videoGenerationService.ts` - è§†é¢‘ç”Ÿæˆä¸šåŠ¡é€»è¾‘
- [x] `screenplayParser.ts` - å‰§æœ¬JSONè§£æå·¥å…·

### âœ… çŠ¶æ€ç®¡ç†

**ä½ç½®**: `src/stores/`

- [x] `chatStore.ts` - èŠå¤©çŠ¶æ€ç®¡ç†
  - æ¶ˆæ¯åˆ—è¡¨ã€ç”¨æˆ·å›¾ç‰‡ã€å½“å‰è‰ç¨¿
  - æ·»åŠ /æ›´æ–°æ¶ˆæ¯ã€å‘é€æ¶ˆæ¯
  - å‰§æœ¬ç”Ÿæˆæµç¨‹
- [x] `screenplayStore.ts` - å‰§æœ¬çŠ¶æ€ç®¡ç†
  - åœºæ™¯è¿›åº¦è¿½è¸ª
- [x] `apiConfigStore.ts` - APIé…ç½®ç®¡ç†
  - é…ç½®CRUDæ“ä½œ
  - localStorageæŒä¹…åŒ–

### âœ… UIç»„ä»¶

**ä½ç½®**: `src/components/`

**åŸºç¡€ç»„ä»¶** (`components/ui/`):
- [x] Button - æŒ‰é’®ç»„ä»¶ï¼ˆæ”¯æŒå¤šç§å˜ä½“ï¼‰
- [x] Input - è¾“å…¥æ¡†ç»„ä»¶
- [x] Card - å¡ç‰‡ç»„ä»¶ç³»åˆ—
- [x] ScrollArea - æ»šåŠ¨åŒºåŸŸ
- [x] Avatar - å¤´åƒç»„ä»¶
- [x] LoadingSpinner / LoadingDots - åŠ è½½åŠ¨ç”»

**èŠå¤©ç»„ä»¶** (`components/chat/`):
- [x] MessageBubble - æ¶ˆæ¯æ°”æ³¡
- [x] MessageList - æ¶ˆæ¯åˆ—è¡¨ï¼ˆå«è‡ªåŠ¨æ»šåŠ¨ï¼‰
- [x] ChatInput - èŠå¤©è¾“å…¥ï¼ˆæ”¯æŒå›¾ç‰‡ä¸Šä¼ ï¼‰

### âœ… APIè·¯ç”±

**ä½ç½®**: `src/app/api/`

- [x] `api/chat/route.ts` - èŠå¤©API
  - POST /api/chat - æ™®é€šå’Œæµå¼å“åº”
- [x] `api/screenplay/route.ts` - å‰§æœ¬API
  - POST /api/screenplay - ç”Ÿæˆå‰§æœ¬è‰ç¨¿
  - GET /api/screenplay/:id - è·å–å‰§æœ¬è¯¦æƒ…

### âœ… é¡µé¢

**ä½ç½®**: `src/app/`

- [x] `page.tsx` - é¦–é¡µï¼ˆé‡å®šå‘åˆ°èŠå¤©ï¼‰
- [x] `layout.tsx` - æ ¹å¸ƒå±€
- [x] `chat/page.tsx` - èŠå¤©é¡µé¢
  - å®Œæ•´çš„èŠå¤©ç•Œé¢
  - æ¶ˆæ¯å‘é€æ¥æ”¶
  - åŠ è½½çŠ¶æ€
- [x] `settings/page.tsx` - è®¾ç½®é¡µé¢
  - APIå¯†é’¥é…ç½®UI

### âœ… å·¥å…·å‡½æ•°

**ä½ç½®**: `src/lib/`

- [x] `utils.ts` - é€šç”¨å·¥å…·å‡½æ•°
  - cn() - ç±»ååˆå¹¶
  - formatDate() - æ—¥æœŸæ ¼å¼åŒ–
  - downloadFile() - æ–‡ä»¶ä¸‹è½½
  - ç­‰...
- [x] `logger.ts` - æ—¥å¿—å·¥å…·

---

## è¿›è¡Œä¸­å·¥ä½œ

### ğŸ”„ å½“å‰å¯ç”¨åŠŸèƒ½

1. **åŸºç¡€èŠå¤©åŠŸèƒ½**
   - ç”¨æˆ·å¯ä»¥å‘é€æ¶ˆæ¯
   - AIä¼šå“åº”ï¼ˆéœ€è¦é…ç½®APIå¯†é’¥ï¼‰
   - æ”¯æŒå›¾ç‰‡ä¸Šä¼ ï¼ˆUIå·²å®ç°ï¼Œåç«¯å¾…å®Œå–„ï¼‰

2. **å‰§æœ¬ç”Ÿæˆ**
   - APIæœåŠ¡å·²å°è£…
   - å‰§æœ¬è§£æå™¨å·²å®ç°
   - å¾…é›†æˆåˆ°èŠå¤©æµç¨‹

3. **çŠ¶æ€ç®¡ç†**
   - Chat Store å¯ç®¡ç†èŠå¤©çŠ¶æ€
   - Screenplay Store å¯ç®¡ç†å‰§æœ¬çŠ¶æ€
   - API Config Store å¯ç®¡ç†APIå¯†é’¥

---

## å¾…å¼€å‘åŠŸèƒ½

### ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### 1. å®Œå–„èŠå¤©åŠŸèƒ½ (é«˜ä¼˜å…ˆçº§)

**æ–‡ä»¶**: `src/app/chat/page.tsx`

- [ ] å®ç°æµå¼å“åº”æ˜¾ç¤º
- [ ] è¿æ¥å‰§æœ¬ç”ŸæˆAPI
- [ ] æ·»åŠ å‰§æœ¬è‰ç¨¿ç¡®è®¤æµç¨‹

#### 2. å‰§æœ¬ç¡®è®¤é¡µé¢ (é«˜ä¼˜å…ˆçº§)

**æ–°å»º**: `src/app/screenplay-review/page.tsx`

éœ€è¦åˆ›å»ºçš„ç»„ä»¶ï¼š
- [ ] ScreenplayInfo - å‰§æœ¬ä¿¡æ¯å±•ç¤º
- [ ] CharacterSheet - è§’è‰²å¡ç‰‡
- [ ] SceneCard - åœºæ™¯å¡ç‰‡
- [ ] ScreenplayReviewForm - ç¼–è¾‘è¡¨å•

**åŠŸèƒ½**ï¼š
- å±•ç¤ºç”Ÿæˆçš„å‰§æœ¬è‰ç¨¿
- å…è®¸ç”¨æˆ·ç¼–è¾‘è§’è‰²å’Œåœºæ™¯
- ç¡®è®¤åå¼€å§‹ç”Ÿæˆåª’ä½“

#### 3. å›¾ç‰‡ç”ŸæˆAPI (é«˜ä¼˜å…ˆçº§)

**æ–°å»º**: `src/app/api/image/route.ts`

```typescript
// POST /api/image/generate - ç”Ÿæˆå•å¼ å›¾ç‰‡
// POST /api/image/character-sheet - ç”Ÿæˆè§’è‰²ä¸‰è§†å›¾
// POST /api/image/batch - æ‰¹é‡ç”Ÿæˆåœºæ™¯å›¾ç‰‡
```

#### 4. è§†é¢‘ç”ŸæˆAPI (é«˜ä¼˜å…ˆçº§)

**æ–°å»º**: `src/app/api/video/route.ts`

```typescript
// POST /api/video/generate - æäº¤è§†é¢‘ä»»åŠ¡
// GET /api/video/status/:taskId - æŸ¥è¯¢çŠ¶æ€
// POST /api/video/batch - æ‰¹é‡ç”Ÿæˆ
// POST /api/video/merge - åˆå¹¶è§†é¢‘
```

#### 5. åœºæ™¯åª’ä½“æŸ¥çœ‹é¡µé¢ (ä¸­ä¼˜å…ˆçº§)

**æ–°å»º**: `src/app/scene-media/page.tsx`

- [ ] å›¾ç‰‡é¢„è§ˆï¼ˆæ”¯æŒç¼©æ”¾ï¼‰
- [ ] è§†é¢‘æ’­æ”¾æ§åˆ¶
- [ ] åœºæ™¯åˆ‡æ¢åŠ¨ç”»
- [ ] è¿›åº¦è¿½è¸ª

#### 6. æ•°æ®åº“é›†æˆ (ä¸­ä¼˜å…ˆçº§)

```bash
npm install prisma @prisma/client sqlite3
npx prisma init
```

- [ ] é…ç½® Prisma schema
- [ ] åˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆConversation, Message, Screenplay, ApiConfigï¼‰
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»
- [ ] å®ç°æ•°æ®æŒä¹…åŒ–

#### 7. æ›´å¤šUIç»„ä»¶ (ä½ä¼˜å…ˆçº§)

**ç»„ä»¶**: `src/components/shared/`

- [ ] GlassCard - ç»ç’ƒæ‹Ÿæ€å¡ç‰‡
- [ ] GradientButton - æ¸å˜æŒ‰é’®
- [ ] ProgressTracker - è¿›åº¦è¿½è¸ªå™¨
- [ ] EmptyState - ç©ºçŠ¶æ€
- [ ] ErrorState - é”™è¯¯çŠ¶æ€

#### 8. ä¼šè¯ç®¡ç† (ä½ä¼˜å…ˆçº§)

**æ–°å»º**: `src/stores/conversationStore.ts`

- [ ] å¤šä¼šè¯ç®¡ç†
- [ ] ä¼šè¯åˆ‡æ¢
- [ ] ä¼šè¯å†å²
- [ ] ä¾§è¾¹æ UI

---

## å¿«é€Ÿç»§ç»­å¼€å‘

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—®: http://localhost:3000

### é…ç½®APIå¯†é’¥

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` å¡«å…¥APIå¯†é’¥ï¼š
```env
ZHIPU_API_KEY=your_zhipu_api_key_here
CANGHE_API_KEY=your_canghe_api_key_here
```

3. æˆ–åœ¨åº”ç”¨ä¸­è®¿é—® http://localhost:3000/settings é…ç½®

### æµ‹è¯•èŠå¤©åŠŸèƒ½

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
2. è®¿é—®èŠå¤©é¡µé¢
3. è¾“å…¥æ¶ˆæ¯å¹¶å‘é€
4. æŸ¥çœ‹AIå“åº”ï¼ˆéœ€è¦é…ç½®APIå¯†é’¥ï¼‰

### ä¸‹ä¸€ä¸ªæ¨èä»»åŠ¡

**å®ç°å‰§æœ¬ç¡®è®¤é¡µé¢** - è¿™æ˜¯è¿æ¥èŠå¤©å’Œåª’ä½“ç”Ÿæˆçš„å…³é”®ç¯èŠ‚

1. åˆ›å»º `src/app/screenplay-review/page.tsx`
2. åˆ›å»ºå‰§æœ¬å±•ç¤ºç»„ä»¶
3. å®ç°ç¼–è¾‘å’Œç¡®è®¤åŠŸèƒ½
4. é›†æˆåˆ°èŠå¤©æµç¨‹ä¸­

---

## æ–‡ä»¶ç»“æ„é€Ÿè§ˆ

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ chat/route.ts âœ…
â”‚   â”‚   â””â”€â”€ screenplay/route.ts âœ…
â”‚   â”œâ”€â”€ chat/page.tsx âœ…
â”‚   â”œâ”€â”€ settings/page.tsx âœ…
â”‚   â”œâ”€â”€ layout.tsx âœ…
â”‚   â””â”€â”€ page.tsx âœ…
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/ âœ… (6ä¸ªåŸºç¡€ç»„ä»¶)
â”‚   â””â”€â”€ chat/ âœ… (3ä¸ªèŠå¤©ç»„ä»¶)
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ chatStore.ts âœ…
â”‚   â”œâ”€â”€ screenplayStore.ts âœ…
â”‚   â””â”€â”€ apiConfigStore.ts âœ…
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ apiService.ts âœ…
â”‚   â”œâ”€â”€ imageGenerationService.ts âœ…
â”‚   â”œâ”€â”€ videoGenerationService.ts âœ…
â”‚   â””â”€â”€ screenplayParser.ts âœ…
â”œâ”€â”€ types/ âœ… (6ä¸ªç±»å‹æ–‡ä»¶)
â””â”€â”€ lib/
    â”œâ”€â”€ utils.ts âœ…
    â””â”€â”€ logger.ts âœ…
```

---

## å·²çŸ¥é—®é¢˜

1. âš ï¸ APIå¯†é’¥éœ€è¦æ‰‹åŠ¨é…ç½®
2. âš ï¸ æµå¼å“åº”æœªå®ç°
3. âš ï¸ å›¾ç‰‡ä¸Šä¼ åç«¯å¤„ç†å¾…å®Œå–„
4. âš ï¸ æ— æ•°æ®åº“æŒä¹…åŒ–ï¼ˆå½“å‰ä½¿ç”¨å†…å­˜å’ŒlocalStorageï¼‰

---

## è´¡çŒ®æŒ‡å—

å¦‚éœ€ç»§ç»­å¼€å‘ï¼š

1. ä»"ä¸‹ä¸€æ­¥å·¥ä½œ"ä¸­é€‰æ‹©ä»»åŠ¡
2. éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
3. ä½¿ç”¨TypeScriptç±»å‹
4. æ›´æ–°æ­¤è¿›åº¦æ–‡æ¡£
5. æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

*æœ¬æ–‡æ¡£ä¼šéšå¼€å‘è¿›åº¦æŒç»­æ›´æ–°*
